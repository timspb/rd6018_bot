# ๐ RD6018 Telegram Controller

> **ะัะพัะตััะธะพะฝะฐะปัะฝะพะต ัะฟัะฐะฒะปะตะฝะธะต ะปะฐะฑะพัะฐัะพัะฝัะผ ะฑะปะพะบะพะผ ะฟะธัะฐะฝะธั RD6018 ัะตัะตะท Home Assistant**

[![Python](https://img.shields.io/badge/Python-3.9+-blue?style=flat-square&logo=python)](https://www.python.org/)
[![aiogram](https://img.shields.io/badge/aiogram-3.x-green?style=flat-square)](https://docs.aiogram.dev/)
[![Home Assistant](https://img.shields.io/badge/Home%20Assistant-REST%20API-blueviolet?style=flat-square&logo=home-assistant)](https://www.home-assistant.io/)

ะัะธะฝััะพะฝะฝัะน Telegram-ะฑะพั ั ะตะดะธะฝัะผ ะดะฐัะฑะพัะดะพะผ: ะณัะฐัะธะบ U/I, ะผะตััะธะบะธ ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ ะธ ะบะฝะพะฟะบะธ ัะฟัะฐะฒะปะตะฝะธั. ะะฝัะตะณัะฐัะธั ั DeepSeek ะดะปั AI-ะฐะฝะฐะปะธะทะฐ ะบัะธะฒะพะน ะทะฐััะดะฐ.

---

## โจ ะะพะทะผะพะถะฝะพััะธ

| ะคัะฝะบัะธั | ะะฟะธัะฐะฝะธะต |
|---------|----------|
| **๐ ะะฐัะฑะพัะด** | ะะดะธะฝ message ั ะณัะฐัะธะบะพะผ ะฝะฐะฟััะถะตะฝะธั/ัะพะบะฐ, ะถะธะฒัะผะธ ะผะตััะธะบะฐะผะธ ะธ inline-ะบะฝะพะฟะบะฐะผะธ |
| **๐ ะะฑะฝะพะฒะปะตะฝะธะต** | ะะณะฝะพะฒะตะฝะฝะพะต ะพะฑะฝะพะฒะปะตะฝะธะต ะดะฐะฝะฝัั ะฑะตะท ัะฟะฐะผะฐ (ัะดะฐะปะตะฝะธะต ััะฐัะพะณะพ message) |
| **๐ ะัะตัะตัั** | AGM (14.4ะ), GEL (14.2ะ), Repair (14.8ะ) โ ะพะดะฝะพ ะฝะฐะถะฐัะธะต ะดะปั ัััะฐะฒะบะธ |
| **โก ะะะ/ะะซะะ** | ะะบะปััะตะฝะธะต ะธ ะพัะบะปััะตะฝะธะต ะฒััะพะดะฐ RD6018 ัะตัะตะท Home Assistant |
| **๐ ะะพะณะธ** | ะะพัะปะตะดะฝะธะต ะทะฐะฟะธัะธ V/I ะธะท ะธััะพัะธะธ ะดะปั ะฑััััะพะน ะฟัะพะฒะตัะบะธ |
| **๐ง AI ะะฝะฐะปะธะท** | DeepSeek ะฐะฝะฐะปะธะทะธััะตั ะบัะธะฒัั ะทะฐััะดะฐ: Bulk/Absorption/Float, ะพัะตะฝะบะฐ ะฒัะตะผะตะฝะธ ะดะพ ะฟะพะปะฝะพะน ะทะฐััะดะบะธ |
| **๐ก ะขะตะฟะปะพะฒะฐั ะทะฐัะธัะฐ** | ะัะธ T > 45ยฐC โ ะฐะฒัะพะผะฐัะธัะตัะบะพะต ะพัะบะปััะตะฝะธะต ะฒััะพะดะฐ ะธ ะฐะปะตัั ะฒ Telegram |
| **๐ ะััะพัะธั** | SQLite: ััะฐะฝะตะฝะธะต V/I/P/T ะบะฐะถะดัะต 30 ั ะดะปั ะณัะฐัะธะบะพะฒ |

---

## ๐ ะกัะตะบ ัะตัะฝะพะปะพะณะธะน

- **aiogram 3.x** โ ะฐัะธะฝััะพะฝะฝัะน Telegram Bot API
- **aiohttp** โ ะฝะตะฑะปะพะบะธััััะธะต ะทะฐะฟัะพัั ะบ Home Assistant
- **aiosqlite** โ ะฐัะธะฝััะพะฝะฝะฐั ัะฐะฑะพัะฐ ั SQLite
- **matplotlib** โ ะฟะพัััะพะตะฝะธะต ะณัะฐัะธะบะพะฒ (ััะผะฝะฐั ัะตะผะฐ)
- **python-dotenv** โ ะทะฐะณััะทะบะฐ ะฟะตัะตะผะตะฝะฝัั ะธะท `.env`

---

## ๐ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
rd6018_bot/
โโโ bot.py           # ะขะพัะบะฐ ะฒัะพะดะฐ, handlers, ะดะฐัะฑะพัะด, data_logger
โโโ config.py        # ะขะพะบะตะฝั, ENTITY_MAP, ะปะธะผะธัั ะฑะตะทะพะฟะฐัะฝะพััะธ
โโโ database.py      # aiosqlite: sensor_history, charge_sessions, charge_log
โโโ hass_api.py      # HassClient: get_state, set_value, turn_on/off
โโโ graphing.py      # generate_chart() โ dual-axis U/I ะณัะฐัะธะบ
โโโ charge_logic.py  # ChargeController: State Machine (Ca/Ca, EFB, AGM)
โโโ ai_engine.py     # ask_deepseek() โ ะฐะฝะฐะปะธะท ะบัะธะฒะพะน ะทะฐััะดะฐ
โโโ requirements.txt
โโโ README.md
```

---

## ๐ ะฃััะฐะฝะพะฒะบะฐ

### 1. ะะปะพะฝะธัะพะฒะฐะฝะธะต ะธ ะทะฐะฒะธัะธะผะพััะธ

```bash
git clone <repo_url>
cd rd6018_bot

pip install -r requirements.txt
```

### 2. ะคะฐะนะป `.env`

ะกะพะทะดะฐะนัะต `.env` ะฒ ะบะพัะฝะต ะฟัะพะตะบัะฐ:

```env
# Telegram (ะพะฑัะทะฐัะตะปัะฝะพ)
TG_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz
# ะธะปะธ TELEGRAM_BOT_TOKEN=...

# Home Assistant
HA_URL=http://192.168.1.100:8123
HA_TOKEN=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# DeepSeek (ะดะปั AI-ะฐะฝะฐะปะธะทะฐ)
DEEPSEEK_API_KEY=sk-...
DEEPSEEK_BASE_URL=https://api.deepseek.com
```

### 3. ะะฐะฟััะบ

```bash
python bot.py
```

---

## ๐ก Home Assistant: ะผะฐะฟะฟะธะฝะณ ัััะฝะพััะตะน

ะะพั ะธัะฟะพะปัะทัะตั ัะปะตะดัััะธะต entity ID (ะดะพะปะถะฝั ัััะตััะฒะพะฒะฐัั ะฒ HA):

| ะะปัั | Entity ID |
|------|-----------|
| voltage | `sensor.rd_6018_output_voltage` |
| current | `sensor.rd_6018_output_current` |
| power | `sensor.rd_6018_output_power` |
| ah | `sensor.rd_6018_battery_charge` |
| wh | `sensor.rd_6018_battery_energy` |
| temp_int | `sensor.rd_6018_temperature` |
| temp_ext | `sensor.rd_6018_temperature_external` |
| is_cv | `binary_sensor.rd_6018_constant_voltage` |
| is_cc | `binary_sensor.rd_6018_constant_current` |
| switch | `switch.rd_6018_output` |
| set_voltage | `number.rd_6018_output_voltage` |
| set_current | `number.rd_6018_output_current` |

---

## ๐ฑ ะะฝัะตััะตะนั

### ะะพะผะฐะฝะดั

- `/start` โ ะพัะบัััั ะดะฐัะฑะพัะด RD6018

### ะะฐัะฑะพัะด (ัะตะบัั)

```
๐ ะกะขะะขะฃะก: ะะะ | CV
โก LIVE:    14.40ะ | 5.00ะ | 72.00ะั
๐ฏ ะฆะะะฌ:    14.40ะ | 10.0ะ
๐ ะะะะะกะขะฌ: 25.50 ะั | 290.1 ะัั
๐ก ะขะะะ:    21.0ยฐC (ะะฝะตั) | 39.0ยฐC (ะะฝััั)
```

### ะะฝะพะฟะบะธ

- **๐ ะะฑะฝะพะฒะธัั** โ ะพะฑะฝะพะฒะธัั ะดะฐัะฑะพัะด
- **๐ ะัะตัะตัั** โ AGM / GEL / Repair
- **๐ ะะพะณะธ** โ ะฟะพัะปะตะดะฝะธะต 5 ะทะฐะฟะธัะตะน U/I
- **๐ง AI ะะฝะฐะปะธะท** โ ะทะฐะฟัะพั ะบ DeepSeek ะฟะพ ะธััะพัะธะธ
- **๐ ะะซะะ** / **โก ะะะ** โ ะฟะตัะตะบะปััะตะฝะธะต ะฒััะพะดะฐ

---

## โ๏ธ ะะตะทะพะฟะฐัะฝะพััั

| ะฃัะปะพะฒะธะต | ะะตะนััะฒะธะต |
|---------|----------|
| `temp_ext > 45ยฐC` | ะะตะผะตะดะปะตะฝะฝะพะต ะพัะบะปััะตะฝะธะต ะฒััะพะดะฐ, ะฐะปะตัั ะฒ Telegram |
| `voltage > 16.6V` | ะัะตะดัะฟัะตะถะดะตะฝะธะต (ะฟัะพะฒะตัะบะฐ ะปะธะผะธัะฐ ะถะตะปะตะทะฐ) |

ะะธะผะธัั ะทะฐะดะฐะฝั ะฒ `config.py`: `MAX_TEMP`, `MAX_TEMP_AGM`, `MAX_VOLTAGE`.

---

## ๐ ะะธัะตะฝะทะธั

MIT
